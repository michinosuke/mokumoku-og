import { ImageResponse } from "next/og";
import { readFile } from "fs/promises";
import { join } from "path";
// App router includes @vercel/og.
// No need to install it.

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const title = searchParams.get("title");
  if (!title) return new Response("query title is required.");
  const day = searchParams.get("day");
  if (!day) return new Response("query day is required.");
  const icon = searchParams.get("icon");
  if (!icon) return new Response("query icon is required.");
  const name = searchParams.get("name");
  if (!name) return new Response("query name is required.");
  return new ImageResponse(
    (
      <div
        style={{
          backgroundColor: "white",
          width: "100%",
          height: "100%",
          display: "flex",
          flexDirection: "column",
          justifyContent: "center",
          position: "relative",
        }}
      >
        <svg
          viewBox="0 0 1817 1263"
          fill="none"
          style={{
            position: "absolute",
            width: 1280 * 1.4386,
            height: 1280,
            top: -223,
            left: -184,
          }}
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M75 205.324C75 276.571 132.757 334.328 204.004 334.328C275.251 334.328 333.008 276.571 333.008 205.324C333.008 134.077 275.251 76.3203 204.004 76.3203C132.757 76.3203 75 134.077 75 205.324Z"
            fill="#FFF2AC"
          />
          <path
            d="M977 1005.32C977 1076.57 1034.76 1134.33 1106 1134.33C1177.25 1134.33 1235.01 1076.57 1235.01 1005.32C1235.01 934.077 1177.25 876.32 1106 876.32C1034.76 876.32 977 934.077 977 1005.32Z"
            fill="#F5D421"
          />
          <path
            d="M1340.94 123.336C1334.75 55.2193 1274.52 5.01708 1206.4 11.206L723.334 55.0959C655.217 61.2848 605.015 121.521 611.204 189.638L612.138 199.916C618.327 268.032 678.563 318.234 746.68 312.045L1229.74 268.155C1297.86 261.966 1348.06 201.73 1341.87 133.614L1340.94 123.336Z"
            fill="#F5D421"
          />
          <path
            d="M742.142 1133.18C760.544 1067.31 722.059 998.989 656.183 980.588L189.013 850.091C123.137 831.689 54.8177 870.175 36.4165 936.05L33.6399 945.99C15.2387 1011.86 53.7239 1080.18 119.599 1098.59L586.77 1229.08C652.645 1247.48 720.965 1209 739.366 1143.12L742.142 1133.18Z"
            fill="#FFF2AC"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M1751.1 786.78C1771.4 852.095 1734.91 921.5 1669.6 941.801L1659.74 944.864C1594.43 965.164 1525.02 928.672 1504.72 863.357L1477.28 775.066L1490.66 770.835C1495.89 769.18 1498.79 763.597 1497.13 758.365L1496.88 757.576C1495.23 752.344 1489.65 749.444 1484.41 751.099L1471.14 755.298L1457.62 711.81L1469.88 707.93C1475.12 706.276 1478.02 700.693 1476.36 695.461L1476.11 694.671C1474.46 689.439 1468.87 686.539 1463.64 688.194L1451.48 692.042L1418.3 585.301L1429.94 581.621C1435.17 579.966 1438.07 574.383 1436.41 569.151L1436.16 568.362C1434.51 563.13 1428.93 560.23 1423.69 561.885L1412.16 565.534L1378.98 458.79L1382.88 457.557C1388.11 455.902 1391.01 450.319 1389.36 445.087L1389.11 444.298C1387.45 439.066 1381.87 436.166 1376.64 437.821L1372.84 439.023L1360.76 400.16C1340.46 334.845 1376.95 265.44 1442.26 245.139L1452.12 242.076C1517.43 221.776 1586.84 258.268 1607.14 323.583L1751.1 786.78ZM1372.84 439.023L1339.53 449.556C1334.3 451.211 1331.4 456.793 1333.06 462.025L1333.31 462.815C1334.96 468.047 1340.54 470.947 1345.78 469.292L1378.98 458.79L1372.84 439.023ZM1412.16 565.534L1386.59 573.62C1381.36 575.274 1378.46 580.857 1380.11 586.089L1380.36 586.879C1382.02 592.111 1387.6 595.011 1392.83 593.356L1418.3 585.301L1412.16 565.534ZM1451.48 692.042L1426.54 699.929C1421.31 701.584 1418.41 707.167 1420.06 712.399L1420.31 713.188C1421.97 718.42 1427.55 721.32 1432.78 719.665L1457.62 711.81L1451.48 692.042ZM1471.14 755.298L1447.31 762.834C1442.08 764.489 1439.18 770.071 1440.83 775.303L1441.08 776.093C1442.74 781.325 1448.32 784.225 1453.55 782.57L1477.28 775.066L1471.14 755.298ZM1484.01 403.863C1489.24 402.208 1494.82 405.108 1496.47 410.34L1496.72 411.129C1498.38 416.361 1495.48 421.944 1490.25 423.599L1453.14 435.334C1447.91 436.989 1442.33 434.089 1440.67 428.857L1440.42 428.067C1438.77 422.835 1441.67 417.253 1446.9 415.598L1484.01 403.863ZM1325.17 464.521C1323.51 459.289 1317.93 456.389 1312.7 458.044L1275.59 469.779C1270.36 471.434 1267.46 477.016 1269.12 482.248L1269.37 483.038C1271.02 488.27 1276.6 491.17 1281.84 489.515L1318.94 477.78C1324.17 476.125 1327.07 470.542 1325.42 465.31L1325.17 464.521ZM1309.62 538.913C1307.96 533.681 1302.38 530.781 1297.15 532.436L1260.04 544.171C1254.81 545.825 1251.91 551.408 1253.57 556.64L1253.82 557.43C1255.47 562.662 1261.05 565.562 1266.29 563.907L1303.39 552.172C1308.62 550.517 1311.52 544.934 1309.87 539.702L1309.62 538.913ZM1440.04 487.242C1445.27 485.588 1450.85 488.488 1452.51 493.72L1452.76 494.509C1454.41 499.741 1451.51 505.324 1446.28 506.979L1409.18 518.714C1403.95 520.368 1398.36 517.469 1396.71 512.237L1396.46 511.447C1394.8 506.215 1397.7 500.632 1402.94 498.978L1440.04 487.242ZM1337.1 658.745C1342.33 657.09 1347.91 659.99 1349.57 665.222L1349.82 666.012C1351.47 671.244 1348.57 676.827 1343.34 678.481L1306.24 690.216C1301 691.871 1295.42 688.971 1293.77 683.739L1293.52 682.95C1291.86 677.718 1294.76 672.135 1299.99 670.48L1337.1 658.745ZM1492.46 620.029C1490.8 614.797 1485.22 611.897 1479.99 613.552L1442.88 625.287C1437.65 626.942 1434.75 632.525 1436.41 637.757L1436.66 638.546C1438.31 643.778 1443.89 646.678 1449.13 645.023L1486.23 633.288C1491.46 631.633 1494.36 626.051 1492.71 620.819L1492.46 620.029ZM1425.04 780.299C1423.39 775.067 1417.8 772.167 1412.57 773.821L1375.47 785.557C1370.23 787.211 1367.33 792.794 1368.99 798.026L1369.24 798.815C1370.89 804.047 1376.48 806.947 1381.71 805.293L1418.81 793.557C1424.04 791.903 1426.94 786.32 1425.29 781.088L1425.04 780.299ZM1591.77 717.143C1597.01 715.489 1602.59 718.388 1604.24 723.62L1604.49 724.41C1606.15 729.642 1603.25 735.225 1598.02 736.879L1560.91 748.615C1555.68 750.269 1550.1 747.369 1548.44 742.137L1548.19 741.348C1546.54 736.116 1549.44 730.533 1554.67 728.878L1591.77 717.143ZM1246.71 500.625C1241.26 502.349 1235.44 499.328 1233.72 493.878C1232 488.428 1235.02 482.612 1240.47 480.889C1245.92 479.165 1251.73 482.186 1253.46 487.636C1255.18 493.086 1252.16 498.901 1246.71 500.625ZM1405.02 439.699C1406.74 445.149 1412.56 448.17 1418.01 446.446C1423.46 444.723 1426.48 438.907 1424.76 433.457C1423.03 428.007 1417.22 424.986 1411.77 426.71C1406.32 428.434 1403.3 434.249 1405.02 439.699ZM1338.52 541.061C1333.07 542.785 1327.25 539.764 1325.53 534.314C1323.81 528.864 1326.83 523.049 1332.28 521.325C1337.73 519.601 1343.54 522.622 1345.27 528.072C1346.99 533.522 1343.97 539.338 1338.52 541.061ZM1361.05 523.079C1362.78 528.529 1368.59 531.55 1374.04 529.826C1379.49 528.102 1382.51 522.287 1380.79 516.837C1379.07 511.387 1373.25 508.366 1367.8 510.09C1362.35 511.814 1359.33 517.629 1361.05 523.079ZM1481.41 495.868C1475.96 497.592 1470.14 494.571 1468.42 489.121C1466.7 483.671 1469.72 477.856 1475.17 476.132C1480.62 474.408 1486.43 477.429 1488.16 482.879C1489.88 488.329 1486.86 494.144 1481.41 495.868ZM1273.67 620.189C1275.39 625.639 1281.21 628.66 1286.66 626.936C1292.11 625.213 1295.13 619.397 1293.4 613.947C1291.68 608.497 1285.87 605.477 1280.42 607.2C1274.97 608.924 1271.94 614.739 1273.67 620.189ZM1322.18 615.701C1316.73 617.425 1310.92 614.404 1309.19 608.954C1307.47 603.504 1310.49 597.689 1315.94 595.965C1321.39 594.241 1327.2 597.262 1328.93 602.712C1330.65 608.162 1327.63 613.977 1322.18 615.701ZM1344.72 597.719C1346.44 603.169 1352.25 606.19 1357.7 604.466C1363.15 602.742 1366.18 596.927 1364.45 591.477C1362.73 586.027 1356.91 583.006 1351.46 584.73C1346.01 586.453 1342.99 592.269 1344.72 597.719ZM1378.47 667.371C1373.02 669.095 1367.2 666.074 1365.48 660.624C1363.76 655.174 1366.78 649.358 1372.23 647.635C1377.68 645.911 1383.49 648.932 1385.22 654.382C1386.94 659.832 1383.92 665.647 1378.47 667.371ZM1401 649.389C1402.73 654.839 1408.54 657.859 1413.99 656.136C1419.44 654.412 1422.46 648.596 1420.74 643.147C1419.02 637.697 1413.2 634.676 1407.75 636.4C1402.3 638.123 1399.28 643.939 1401 649.389ZM1521.36 622.178C1515.91 623.901 1510.09 620.881 1508.37 615.431C1506.65 609.981 1509.67 604.165 1515.12 602.442C1520.57 600.718 1526.38 603.739 1528.11 609.189C1529.83 614.639 1526.81 620.454 1521.36 622.178ZM1313.62 746.499C1315.34 751.949 1321.16 754.97 1326.61 753.246C1332.06 751.522 1335.08 745.707 1333.35 740.257C1331.63 734.807 1325.81 731.786 1320.36 733.51C1314.91 735.234 1311.89 741.049 1313.62 746.499ZM1362.13 742.011C1356.68 743.734 1350.86 740.714 1349.14 735.264C1347.42 729.814 1350.44 723.998 1355.89 722.275C1361.34 720.551 1367.15 723.572 1368.88 729.022C1370.6 734.472 1367.58 740.287 1362.13 742.011ZM1384.66 724.028C1386.39 729.478 1392.2 732.499 1397.65 730.775C1403.1 729.052 1406.12 723.236 1404.4 717.786C1402.68 712.336 1396.86 709.316 1391.41 711.039C1385.96 712.763 1382.94 718.578 1384.66 724.028ZM1346.58 816.403C1341.13 818.126 1335.32 815.106 1333.59 809.656C1331.87 804.206 1334.89 798.39 1340.34 796.667C1345.79 794.943 1351.6 797.964 1353.33 803.414C1355.05 808.863 1352.03 814.679 1346.58 816.403ZM1512.8 752.977C1514.52 758.427 1520.34 761.448 1525.79 759.724C1531.24 758.001 1534.26 752.185 1532.53 746.735C1530.81 741.285 1524.99 738.265 1519.54 739.988C1514.09 741.712 1511.07 747.527 1512.8 752.977Z"
            fill="#051B2E"
          />
        </svg>

        <div
          style={{
            display: "flex",
            alignItems: "center",
            gap: 20,
            position: "absolute",
            top: 60,
            left: 60,
            zIndex: 1000,
          }}
        >
          <svg
            id="ロゴ"
            width="74"
            height="74"
            viewBox="0 0 74 74"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clip-path="url(#clip0_126_2067)">
              <path d="M1 1L19 8H55L73 1V73L55 65.5H19L1 73V1Z" fill="white" />
              <path
                d="M72.596 0.264366L54.8024 7.38149H19.2507L1.45715 0.264366C0.812418 0.0229579 0.226562 0.51019 0.226562 1.09899V72.9046C0.226562 73.492 0.812418 73.9807 1.45715 73.7392L19.2507 66.6221H54.801L72.5945 73.7392C73.2392 73.9807 73.8251 73.492 73.8251 72.9046V1.09899C73.8251 0.511662 73.2392 0.0229579 72.5945 0.264366H72.596ZM18.1776 65.1163L2.02093 71.5783V2.42379L18.1776 8.88587V65.1163ZM54.0797 64.8248H19.972V9.17585H54.0797V64.8248ZM72.0307 71.5783L55.8741 65.1163V8.88587L72.0307 2.42379V71.5783Z"
                fill="#051B2E"
              />
              <path
                d="M19.8516 8.78516H54.1982V65.2118H19.8516V8.78516Z"
                fill="url(#paint0_radial_126_2067)"
              />
            </g>
            <defs>
              <radialGradient
                id="paint0_radial_126_2067"
                cx="0"
                cy="0"
                r="1"
                gradientUnits="userSpaceOnUse"
                gradientTransform="translate(37.0249 36.9985) rotate(90) scale(28.2133 17.1733)"
              >
                <stop stop-color="#FFF2AC" />
                <stop offset="1" stop-color="#F5D421" />
              </radialGradient>
              <clipPath id="clip0_126_2067">
                <rect
                  width="73.6"
                  height="73.6"
                  fill="white"
                  transform="translate(0.226562 0.199219)"
                />
              </clipPath>
            </defs>
          </svg>
          <div
            style={{
              display: "flex",
              alignItems: "center",
              padding: "0px 25px 7px",
              backgroundColor: "#071623",
              color: "white",
              lineHeight: "36px",
              height: 60,
              borderRadius: 60 / 2,
              fontWeight: 700,
            }}
          >
            <div style={{ fontSize: 46, padding: "0 14px 12px 0" }}>#</div>
            <div style={{ fontSize: 40, paddingBottom: 8 }}>もくもく</div>
            <div style={{ fontSize: 42, paddingBottom: 7 }}>ブログリレー</div>
            <div style={{ fontSize: 46, padding: "0 2px 14px 14px" }}>
              {day}
            </div>
            <div style={{ fontSize: 40, paddingBottom: 8 }}>日目</div>
          </div>
        </div>

        <div
          style={{
            width: 1000,
            paddingLeft: 60,
            fontSize: 70,
            paddingBottom: 70,
            fontWeight: "bold",
          }}
        >
          {title}
        </div>

        <div
          style={{
            position: "absolute",
            bottom: 44,
            left: 60,
            display: "flex",
            // alignItems: "center",
            justifyContent: "flex-start",
            gap: 20,
          }}
        >
          <img
            src={icon}
            width={138}
            height={138}
            style={{ borderRadius: "100%", margin: 0 }}
          />
          <div
            style={{
              fontSize: 42,
              display: "flex",
              height: "100%",
              lineHeight: "110px",
              margin: 0,
            }}
          >
            {name}
          </div>
        </div>
      </div>
    ),
    {
      width: 1440,
      height: 810,
      fonts: [
        {
          data: await readFile(
            join(process.cwd(), "public/ZenKakuGothicNew-Medium.ttf")
          ),
          name: "zen",
          weight: 500,
          style: "normal",
        },
        {
          data: await readFile(
            join(process.cwd(), "public/ZenKakuGothicNew-Bold.ttf")
          ),
          name: "zen",
          weight: 700,
          style: "normal",
        },
      ],
    }
  );
}
